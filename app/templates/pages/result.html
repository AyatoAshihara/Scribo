{% extends "base.html" %}

{% block content %}
<div 
    x-data="scoringResult('{{ submission_id }}')" 
    x-init="init()"
    class="max-w-4xl mx-auto">
    
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã -->
    <template x-if="loading">
        <div class="flex flex-col justify-center items-center py-20">
            <span class="loading loading-spinner loading-lg text-primary mb-4"></span>
            <p class="text-base-content/70">Êé°ÁÇπÁµêÊûú„ÇíÂèñÂæó‰∏≠...</p>
        </div>
    </template>
    
    <!-- „Ç®„É©„ÉºÁä∂ÊÖã -->
    <template x-if="error">
        <div class="alert alert-error">
            <span x-text="error"></span>
            <a href="/" class="btn btn-sm">‰∏ÄË¶ß„Å´Êàª„Çã</a>
        </div>
    </template>
    
    <!-- Êé°ÁÇπÁµêÊûú -->
    <template x-if="!loading && !error && result">
        <div class="space-y-6">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <div class="text-center">
                <h1 class="text-3xl font-bold mb-2">Êé°ÁÇπÁµêÊûú</h1>
                <p class="text-base-content/70" x-text="'ÊèêÂá∫ID: ' + submission_id"></p>
            </div>
            
            <!-- Á∑èÂêà„Çπ„Ç≥„Ç¢„Ç´„Éº„Éâ -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body items-center text-center">
                    <div 
                        class="radial-progress text-6xl font-bold"
                        :class="getRankColor(result.final_rank)"
                        :style="'--value:' + result.aggregate_score + '; --size: 12rem; --thickness: 1rem;'"
                        role="progressbar">
                        <span x-text="result.final_rank"></span>
                    </div>
                    <h2 class="card-title mt-4">
                        Á∑èÂêà„Çπ„Ç≥„Ç¢: <span x-text="result.aggregate_score.toFixed(1)"></span>ÁÇπ
                    </h2>
                    <div 
                        class="badge badge-lg"
                        :class="result.passed ? 'badge-success' : 'badge-warning'">
                        <span x-text="result.passed ? '‚úÖ ÂêàÊ†º„É©„Ç§„É≥ÈÅîÊàê' : 'üìö „Åï„Çâ„Å™„ÇãÂ≠¶Áøí„ÅåÂøÖË¶Å'"></span>
                    </div>
                </div>
            </div>
            
            <!-- Ë®≠ÂïèÂà•Ë©ï‰æ° -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title">Ë®≠ÂïèÂà•Ë©ï‰æ°</h3>
                    
                    <div class="overflow-x-auto">
                        <table class="table table-zebra">
                            <thead>
                                <tr>
                                    <th>Ë®≠Âïè</th>
                                    <th>„É©„É≥„ÇØ</th>
                                    <th>„Çπ„Ç≥„Ç¢</th>
                                    <th>ÊñáÂ≠óÊï∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(breakdown, question) in result.question_breakdown" :key="question">
                                    <tr>
                                        <td x-text="question"></td>
                                        <td>
                                            <span 
                                                class="badge"
                                                :class="getRankColor(breakdown.level)"
                                                x-text="breakdown.level">
                                            </span>
                                        </td>
                                        <td x-text="breakdown.question_score + 'ÁÇπ'"></td>
                                        <td x-text="breakdown.word_count + 'Â≠ó'"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Ë¶≥ÁÇπÂà•Ë©ï‰æ° -->
            <template x-for="(breakdown, question) in result.question_breakdown" :key="question">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title" x-text="question + '„ÅÆË©≥Á¥∞Ë©ï‰æ°'"></h3>
                        
                        <div class="space-y-3">
                            <template x-for="score in breakdown.criteria_scores" :key="score.criterion">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium" x-text="score.criterion"></span>
                                        <span class="text-sm" x-text="score.points + 'ÁÇπ'"></span>
                                    </div>
                                    <progress 
                                        class="progress w-full"
                                        :class="getProgressColor(score.points)"
                                        :value="score.points" 
                                        max="100">
                                    </progress>
                                    <template x-if="score.comment">
                                        <p class="text-xs text-base-content/70 mt-1" x-text="score.comment"></p>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </template>
            
            <!-- Êàª„Çã„Éú„Çø„É≥ -->
            <div class="flex justify-center gap-4">
                <a href="/" class="btn btn-outline">Ë©¶È®ì‰∏ÄË¶ß„Å´Êàª„Çã</a>
            </div>
        </div>
    </template>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/result.js"></script>
{% endblock %}
