<!DOCTYPE html>
<html lang="ja" data-theme="light" x-data="{ 
    darkMode: localStorage.getItem('theme') === 'dark',
    init() {
        this.applyTheme();
        this.$watch('darkMode', () => this.applyTheme());
    },
    applyTheme() {
        localStorage.setItem('theme', this.darkMode ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', this.darkMode ? 'dark' : 'light');
    }
}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ title }} | Scribo{% endblock %}</title>
    
    <!-- Google Fonts Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <!-- Tailwind CSS + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Roboto', 'Noto Sans JP', 'sans-serif'],
                    },
                }
            },
            daisyui: {
                themes: [
                    {
                        scribo: {
                            "primary": "#6750A4",
                            "primary-content": "#FFFFFF",
                            "secondary": "#625B71",
                            "accent": "#7D5260",
                            "neutral": "#79747E",
                            "base-100": "#FEF7FF",
                            "base-200": "#E7E0EC",
                            "base-300": "#FDF8FD",
                            "info": "#21005D",
                            "success": "#10b981",
                            "warning": "#f59e0b",
                            "error": "#B3261E",
                            "--rounded-box": "1rem",
                            "--rounded-btn": "100px",
                            "--rounded-badge": "1.9rem",
                            "--animation-btn": "0.25s",
                            "--btn-focus-scale": "0.95",
                            "--border-btn": "1px",
                            "--tab-border": "1px",
                            "--tab-radius": "0.5rem",
                        },
                    }
                ],
            },
        }
    </script>
    
    <!-- htmx -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2/sse.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
    
    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- テーマ初期化（FOUC防止） -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') === 'dark' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    {% block head %}{% endblock %}
</head>
<body class="min-h-screen bg-base-300 font-sans text-base-content">
    <div class="drawer lg:drawer-open">
        <input id="main-drawer" type="checkbox" class="drawer-toggle" />
        
        <!-- Main Content Area -->
        <div class="drawer-content flex flex-col min-h-screen">
            <!-- Top App Bar -->
            <header class="navbar bg-base-100 sticky top-0 z-40 px-4 shadow-sm">
                <div class="flex-none lg:hidden">
                    <label for="main-drawer" class="btn btn-square btn-ghost">
                        <span class="material-symbols-rounded">menu</span>
                    </label>
                </div>
                <div class="flex-1 lg:hidden">
                    <a href="/" class="flex items-center gap-2 text-xl font-bold text-primary">
                        <span class="material-symbols-rounded">edit_note</span>
                        <span>Scribo</span>
                    </a>
                </div>
                <div class="flex-1 hidden lg:block">
                    <!-- Desktop Title/Breadcrumbs could go here -->
                </div>
                
                <div class="flex-none gap-2">
                    <!-- Timer Slot -->
                    <div id="timer-slot">
                        {% block timer %}{% endblock %}
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <label class="swap swap-rotate btn btn-ghost btn-circle text-primary">
                        <input type="checkbox" x-model="darkMode" class="theme-controller" />
                        <span class="material-symbols-rounded swap-off fill-current">light_mode</span>
                        <span class="material-symbols-rounded swap-on fill-current">dark_mode</span>
                    </label>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="flex-1 p-4 lg:p-8 max-w-7xl mx-auto w-full">
                {% block content %}{% endblock %}
            </main>
            
            <!-- Footer -->
            <footer class="footer footer-center p-4 bg-base-100 text-base-content/60 border-t border-base-200">
                <aside>
                    <p class="text-sm">Scribo - The Strategist's Forge</p>
                </aside>
            </footer>
        </div> 
        
        <!-- Navigation Drawer (Sidebar) -->
        <div class="drawer-side z-50">
            <label for="main-drawer" aria-label="close sidebar" class="drawer-overlay"></label> 
            <aside class="bg-base-100 min-h-full w-80 p-4 flex flex-col gap-4 border-r border-base-200">
                <!-- Logo Area -->
                <div class="flex items-center gap-3 px-4 py-2">
                    <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary">
                        <span class="material-symbols-rounded text-2xl">edit_note</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-base-content">Scribo</h1>
                        <p class="text-xs text-base-content/60">Strategist's Forge</p>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <ul class="menu text-base-content gap-2">
                    <li>
                        <a href="/" class="rounded-full active:bg-primary-container active:text-on-primary-container hover:bg-base-200">
                            <span class="material-symbols-rounded">dashboard</span>
                            ダッシュボード
                        </a>
                    </li>
                    
                    <li class="menu-title mt-4 text-primary font-medium">資産化 (Assets)</li>
                    <li>
                        <a href="/modules" class="rounded-full hover:bg-base-200">
                            <span class="material-symbols-rounded">inventory_2</span>
                            準備モジュール
                        </a>
                    </li>
                    
                    <li class="menu-title mt-4 text-primary font-medium">設計 (Design)</li>
                    <li>
                        <a href="/designs" class="rounded-full hover:bg-base-200">
                            <span class="material-symbols-rounded">architecture</span>
                            論文設計
                        </a>
                    </li>
                    
                    <li class="menu-title mt-4 text-primary font-medium">学習 (Learn)</li>
                    <li>
                        <a href="/history" class="rounded-full hover:bg-base-200">
                            <span class="material-symbols-rounded">history</span>
                            学習履歴
                        </a>
                    </li>
                </ul>
            </aside>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="toast toast-end toast-bottom z-50"></div>
    
    <!-- カスタムスクリプト -->
    <script src="/static/js/app.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
